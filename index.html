<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostic</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; font-size: 14px; }
        h2 { border-bottom: 1px solid #0f0; padding-bottom: 10px; }
        .log-line { margin: 5px 0; border-left: 2px solid #333; padding-left: 10px; }
        .error { color: #ff3333; font-weight: bold; }
        .success { color: #33ff33; }
        button { 
            padding: 15px; width: 100%; margin: 20px 0; 
            background: #222; border: 1px solid #0f0; color: #0f0; font-size: 16px; 
        }
        #video-preview { width: 150px; border: 1px solid #444; margin-top: 10px; }
    </style>
</head>
<body>

<h2>DIAGNOSTIC MODE</h2>
<div id="logs">Waiting for user input...</div>
<button onclick="runDiagnostics()">START DIAGNOSTIC TEST</button>
<video id="video-preview" playsinline muted autoplay></video>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

<script>
    const logger = document.getElementById('logs');
    function log(msg, type = 'normal') {
        const div = document.createElement('div');
        div.className = 'log-line ' + type;
        div.innerText = `> ${msg}`;
        logger.appendChild(div);
    }

    window.onerror = function(msg, url, line) {
        log(`CRASH: ${msg} (Line ${line})`, 'error');
    };

    async function runDiagnostics() {
        logger.innerHTML = ''; // Clear logs
        log("Test 1: Check Libraries...");
        
        // STEP 1: Library Check
        if (window.THREE) log("‚úÖ Three.js Loaded", 'success');
        else log("‚ùå Three.js MISSING", 'error');

        if (window.Hands) log("‚úÖ MediaPipe Hands Loaded", 'success');
        else log("‚ùå MediaPipe Hands MISSING", 'error');

        // STEP 2: Camera Check
        log("Test 2: Requesting Camera...");
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'user', width: 640 } 
            });
            log("‚úÖ Camera Permission GRANTED", 'success');
            
            const video = document.getElementById('video-preview');
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                video.play();
                log("‚úÖ Video Feed Active", 'success');
                startMediaPipe(video);
            };
        } catch (e) {
            log(`‚ùå CAMERA FAIL: ${e.name} - ${e.message}`, 'error');
            log("üëâ TIP: Check Chrome Settings > Site Settings > Camera", 'normal');
        }
    }

    function startMediaPipe(videoElement) {
        log("Test 3: Starting AI Tracking...");
        try {
            const hands = new Hands({locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
            }});
            
            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 0, // Fastest mode
                minDetectionConfidence: 0.5
            });

            hands.onResults((results) => {
                if(results.multiHandLandmarks.length > 0) {
                    log("‚úÖ HAND DETECTED! (System Working)", 'success');
                    // Stop spamming log
                    hands.onResults(() => {}); 
                }
            });

            const camera = new Camera(videoElement, {
                onFrame: async () => { await hands.send({image: videoElement}); },
                width: 640, height: 480
            });
            camera.start();
            log("‚úÖ AI Engine Running... Wave your hand!", 'normal');

        } catch(e) {
            log(`‚ùå AI CRASH: ${e.message}`, 'error');
        }
    }
</script>
</body>
</html>
